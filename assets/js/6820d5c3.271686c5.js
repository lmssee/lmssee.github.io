"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[37596],{29087:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(96363);const o={},l=i.createContext(o);function r(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(l.Provider,{value:n},e.children)}},34382:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>s});const i=JSON.parse('{"id":"XHR 2/file","title":"file","description":"\u540e\u53f0 php \u6587\u4ef6\uff1a","source":"@site/js/XHR 2/file.mdx","sourceDirName":"XHR 2","slug":"/XHR 2/file","permalink":"/js/XHR 2/file","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"file"},"sidebar":"az2Kt0VR0KcelL2W","previous":{"title":"form","permalink":"/js/XHR 2/form"},"next":{"title":"\u63a5\u53e3","permalink":"/js/XHR 2/\u63a5\u53e3"}}');var o=t(47259),l=t(29087);const r={title:"file"},a="\u6587\u4ef6\u4e0a\u4f20",d={},s=[];function f(e){const n={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"\u6587\u4ef6\u4e0a\u4f20",children:"\u6587\u4ef6\u4e0a\u4f20"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'<!doctype html>\n<html>\n  <head>\n    <meta charset="utf-8" />\n    <title></title>\n\n    function fileSelected() {var file =\n    document.getElementById(\'fileToUpload\').files[0];if (file) {var fileSize =\n    0;if (file.size > 1024 * 1024) fileSize = (Math.round(file.size * 100 /\n    (1024 * 1024)) / 100).toString() + \'MB\';elsefileSize = (Math.round(file.size\n    * 100 / 1024) / 100).toString() +\n    \'KB\';document.getElementById(\'fileName\').innerHTML = \' \u6587\u4ef6\u540d : \' +\n    file.name; document.getElementById(\'fileSize\').innerHTML = \' \u5927 \u5c0f : \' +\n    fileSize;document.getElementById(\'fileType\').innerHTML = \' \u7c7b \u578b : \' +\n    file.type;}} function uploadFile() {var fd = new\n    FormData();fd.append("fileToUpload",\n    document.getElementById(\'fileToUpload\').files[0]);var xhr = new\n    XMLHttpRequest(); xhr.upload.addEventListener("progress", uploadProgress,\n    false);xhr.addEventListener("load", uploadComplete,\n    false);xhr.addEventListener("error", uploadFailed, false);\n    xhr.addEventListener("abort", uploadCanceled, false);xhr.open("POST",\n    "test.php");xhr.send(fd);}function uploadProgress(evt) { if\n    (evt.lengthComputable) {var percentComplete = Math.round(evt.loaded * 100 /\n    evt.total);document.getElementById(\'progressNumber\').innerHTML =\n    percentComplete.toString() + \'%\'; } else\n    {document.getElementById(\'progressNumber\').innerHTML = \'unable to\n    compute\';}}function uploadComplete(evt) { var info =\n    document.getElementById(\'info\');/* \u5f53\u670d\u52a1\u5668\u53d1\u9001\u54cd\u5e94\u65f6\uff0c\u4f1a\u5f15\u53d1\u6b64\u4e8b\u4ef6\n    */info.innerHTML = evt.target.responseText;} function uploadFailed(evt)\n    {alert(" \u8bd5\u56fe\u4e0a\u8f7d\u6587\u4ef6\u65f6\u51fa\u73b0\u4e00\u4e2a\u9519\u8bef ");}function uploadCanceled(evt)\n    {alert(" \u4e0a\u4f20\u5df2\u88ab\u7528\u6237\u53d6\u6d88\u6216\u6d4f\u89c8\u5668\u653e\u5f03\u8fde\u63a5 "); }\n  </head>\n  <body>\n    <form\n      id="form1"\n      enctype="multipart/form-data"\n      method="post"\n      action="upload.php"\n    >\n      <div class="row">\n        <label for="fileToUpload"> \u9009\u62e9\u4e0a\u4f20\u6587\u4ef6 </label\n        ><input\n          type="file"\n          name="fileToUpload"\n          id="fileToUpload"\n          onchange="fileSelected();"\n        />\n      </div>\n      <div id="fileName"></div>\n      <div id="fileSize"></div>\n      <div id="fileType"></div>\n      <div class="row">\n        <input type="button" onclick="uploadFile()" value=" \u4e0a\u4f20 " />\n      </div>\n      <div id="progressNumber"></div>\n      <div id="info"></div>\n    </form>\n  </body>\n</html>\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u540e\u53f0 php \u6587\u4ef6\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-php",children:"<?php header('content=text/html;charset=utf-8'); $uf = $_FILES('fileToUpload');\n    if($uf){ echo \" \u6ca1\u6709 fileToUpload \u5f15\u7528 \"; exit(); }\n$upload_file_temp = $uf['tem_name']; $upload_file_name = $uf['name'];\n    $upload_file_size=$uf['size'];if(!$upload_file_temp){\n  echo ' \u4e0a\u4f20\u5931\u8d25 '; exit(); } $file_size_max = 1024*1024*100;//\n      100M \u9650\u5236\u6587\u4ef6\u4e0a\u4f20\u6700\u5927\u5bb9\u91cf\uff08 bytes \uff09 if($upload_file_size>$file_size_max){ //\n      \u68c0\u67e5\u6587\u4ef6 echo 'sorry \uff0c you file size is too\n    large and the server refuses to receive it !!!'.$file_size_max; exit(); } $store_dir='./upload';// \u670d\u52a1\u5668\u50a8\u5b58\u4f4d\u7f6e ;\n    $accept_overwrite =0; $accept_path = $store_dir . $upload_file_name; if(file_exists($file_path) &&\n!$accept_overwrite){\n  echo ' \u5b58\u5728\u76f8\u540c\u6587\u4ef6\u540d\u6587\u4ef6 ';\n  exit(); } if(!move_uploaded_file($upload_file_temp,$file_path)){ echo\n    ' \u590d\u5236\u6587\u4ef6\u5931\u8d25 '.$upload_file_temp.'to'.$file_path; exit(); } Echo\n    '<p> \u4f60\u4e0a\u4f20\u4e86\u6587\u4ef6\uff1a '.$upload_file_name.' \u6587\u4ef6\u7684 MIME \u7c7b\u578b '.$uf['type'];\n    echo' \u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\uff1a '.$uf['size']; Echo ' \u6587\u4ef6\u88ab\u4e34\u65f6\u50a8\u5b58\u4e3a\uff1a '.$uf['tmp_name']; echo '';\n    $error = $uf['error']; switch($error){\ncase 0: Echo ' \u4e0a\u4f20\u6210\u529f ';break; case 1: Echo\n' \u4e0a\u4f20\u6587\u4ef6\u592a\u5927 ';break; case 2: Echo ' \u4e0a\u4f20\u5927\u5c0f\u8d85\u8fc7 HTML \u8868\u5355\u6700\u5927\u503c ';break; case\n3 : Echo ' \u53ea\u6709\u90e8\u5206\u6587\u4ef6\u88ab\u4e0a\u4f20 ';break;\ncase 4: Echo ' \u6ca1\u6709\u6587\u4ef6\u88ab\u4e0a\u4f20 ';break; } ?>\n"})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(f,{...e})}):f(e)}}}]);
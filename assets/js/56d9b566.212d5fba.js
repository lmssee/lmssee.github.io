"use strict";(globalThis.webpackChunknotebook=globalThis.webpackChunknotebook||[]).push([[48272],{31480(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"\u4e86\u89e3/Mutation","title":"Mutation","description":"Mutation Observer \u8868\u793a\u53d8\u52a8\u89c2\u5bdf\u5668\uff0c\u76d1\u89c6 DOM \u53d8\u5316\u7684\u63a5\u53e3\u3002\u5f53 DOM \u5bf9\u8c61\u6811\u53d1\u751f\u53d8\u5316\u65f6\uff0c Mutation Observer \u4f1a\u63a5\u5230\u901a\u77e5\u3002","source":"@site/html/\u4e86\u89e3/Mutation.mdx","sourceDirName":"\u4e86\u89e3","slug":"/\u4e86\u89e3/Mutation","permalink":"/html/\u4e86\u89e3/Mutation","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Mutation"},"sidebar":"RRhFQ58Ul1J5KCbn","previous":{"title":"Animation","permalink":"/html/\u4e86\u89e3/Animation"},"next":{"title":"Promise","permalink":"/html/\u4e86\u89e3/Promise"}}');var r=t(56730),s=t(25502);const l={title:"Mutation"},a="Mutation Observer",o={},c=[{value:"\u652f\u6301\u68c0\u6d4b",id:"\u652f\u6301\u68c0\u6d4b",level:2},{value:"\u4f7f\u7528\u6b65\u9aa4",id:"\u4f7f\u7528\u6b65\u9aa4",level:2},{value:"\u521b\u5efa\u5b9e\u4f8b",id:"\u521b\u5efa\u5b9e\u4f8b",level:2},{value:"\u6307\u5b9a\u89c2\u6d4b\u5bf9\u8c61",id:"\u6307\u5b9a\u89c2\u6d4b\u5bf9\u8c61",level:2},{value:"\u505c\u6b62\u89c2\u5bdf",id:"\u505c\u6b62\u89c2\u5bdf",level:2},{value:"\u6e05\u9664\u8bb0\u5f55",id:"\u6e05\u9664\u8bb0\u5f55",level:2},{value:"\u89e6\u53d1\u4e8b\u4ef6",id:"\u89e6\u53d1\u4e8b\u4ef6",level:2},{value:"\u6848\u4f8b 1",id:"\u6848\u4f8b-1",level:2},{value:"\u6848\u4f8b 2",id:"\u6848\u4f8b-2",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"mutation-observer",children:"Mutation Observer"})}),"\n",(0,r.jsx)(n.p,{children:"Mutation Observer \u8868\u793a\u53d8\u52a8\u89c2\u5bdf\u5668\uff0c\u76d1\u89c6 DOM \u53d8\u5316\u7684\u63a5\u53e3\u3002\u5f53 DOM \u5bf9\u8c61\u6811\u53d1\u751f\u53d8\u5316\u65f6\uff0c Mutation Observer \u4f1a\u63a5\u5230\u901a\u77e5\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4e8b\u4ef6\u662f\u540c\u6b65\u89e6\u53d1\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4 DOM \u53d1\u751f\u53d8\u52a8\u4f1a\u7acb\u5373\u89e6\u53d1\u76f8\u5e94\u7684\u4e8b\u4ef6"}),"\n",(0,r.jsx)(n.li,{children:"Mutation Observer \u662f\u5f02\u6b65\u89e6\u53d1\u7684\uff0c DOM \u89e6\u53d1\u540e\uff0c\u5fc5\u4e0d\u4f1a\u9a6c\u4e0a\u89e6\u53d1\u800c\u662f\u8981\u7b49\u5230\u5f53\u524d\u6240\u6709\u7684 DOM \u64cd\u4f5c\u5b8c\u6bd5\u624d\u4f1a\u89e6\u53d1\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Mutation Observer \u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7b49\u5f85\u6240\u6709\u7684\u811a\u672c\u4efb\u52a1\u5b8c\u6bd5\u540e\uff0c\u624d\u4f1a\u8fd0\u52a8\uff0c\u800c\u4e14\u53ea\u89e6\u53d1\u4e00\u6b21"}),"\n",(0,r.jsx)(n.li,{children:"\u628a DOM \u53d8\u52a8\u8bb0\u5f55\u6210\u4e00\u4e2a\u6570\u7ec4\uff0c\u800c\u4e0d\u662f\u4e00\u6761\u6761\u7684\u4e2a\u522b\u5904\u7406 DOM \u53d8\u52a8"}),"\n",(0,r.jsx)(n.li,{children:"\u53ef\u4ee5\u89c2\u5bdf\u53d1\u751f\u5728 DOM \u8282\u70b9\u7684\u53d8\u52a8\uff0c\u4e5f\u53ef\u4ee5\u89c2\u5bdf\u67d0\u4e00\u7c7b\u53d8\u52a8"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u652f\u6301\u68c0\u6d4b",children:"\u652f\u6301\u68c0\u6d4b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:"showLineNumbers",children:"const MutationObserver =\n  window.MutationObserver ||\n  window.WebkitMutationObserver ||\n  widow.MozMutationObserver;\nconst MutationObserverSupport = !!MutationObserver;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4f7f\u7528\u6b65\u9aa4",children:"\u4f7f\u7528\u6b65\u9aa4"}),"\n",(0,r.jsx)(n.h2,{id:"\u521b\u5efa\u5b9e\u4f8b",children:"\u521b\u5efa\u5b9e\u4f8b"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 MutationObserver() \u6784\u9020\u51fd\u6570\uff0c\u65b0\u5efa\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u540c\u65f6\u6307\u5b9a\u8fd9\u4e2a\u5b9e\u4f8b\u7684\u56de\u8c03\u51fd\u6570\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:"showLineNumbers",children:"const observer = new MutationObserver(callback);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6307\u5b9a\u89c2\u6d4b\u5bf9\u8c61",children:"\u6307\u5b9a\u89c2\u6d4b\u5bf9\u8c61"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 observe() \u65b9\u6cd5\u6307\u5b9a\u8981\u89c2\u5bdf\u7684 DOM \u5143\u7d20\uff0c\u4ee5\u53ca\u8981\u89c2\u5bdf\u7684\u7279\u5b9a\u5f85\u52a8\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:"showLineNumbers",children:"const article = document.querySelector('article');\nconst options = { childList: true, attributes: true };\nobserver.observer(article, options);\n"})}),"\n",(0,r.jsx)(n.p,{children:"MutationObserver \u6240\u89c2\u5bdf\u7684 DOM \u53d8\u52a8\uff0c\u5305\u542b\u4e0b\u5217\u7c7b\u578b\uff0c\u8bbe\u7f6e\u4e3a\u5e03\u5c14\u578b\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"childList \u3000\uff1a\u5b50\u5143\u7d20\u7684\u53d8\u5316"}),"\n",(0,r.jsx)(n.li,{children:"attributes \uff1a \u5c5e\u6027\u7684\u53d8\u52a8"}),"\n",(0,r.jsx)(n.li,{children:"characterData \uff1a\u8282\u70b9\u5185\u5bb9\u6216\u8282\u70b9\u6587\u672c\u7684\u53d8\u52a8"}),"\n",(0,r.jsx)(n.li,{children:"attributeOldValue \uff1a \u82e5\u8bbe\u7f6e\u4e3a true \uff0c\u5219\u8868\u793a\u9700\u8981\u8bb0\u5f55\u53d8\u52a8\u524d\u7684\u5c5e\u6027\u503c"}),"\n",(0,r.jsx)(n.li,{children:"characterDataOldValue \uff1a \u5982\u679c\u8bbe\u7f6e\u4e3a true \uff0c\u5219\u8868\u793a\u9700\u8981\u8bb0\u5f55\u53d8\u52a8\u524d\u7684\u6570\u636e\u503c\u503c"}),"\n",(0,r.jsx)(n.li,{children:"attributeFilter \uff1a \u503c\u4e3a\u4e00\u4e2a\u6570\u7ec4\uff0c\u8868\u793a\u8981\u89c2\u5bdf\u7684\u7279\u5b9a\u5c5e\u6027\uff0c\u5982 ['class','str']"}),"\n",(0,r.jsx)(n.li,{children:"subtree \uff1a \u6240\u6709\u4e0b\u5c5e\u8282\u70b9\uff08\u5305\u62ec\u5b50\u8282\u70b9\u548c\u5b50\u8282\u70b9\u7684\u5b50\u8282\u70b9\uff09\u7684\u53d8\u52a8"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u505c\u6b62\u89c2\u5bdf",children:"\u505c\u6b62\u89c2\u5bdf"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 disconnect() \u65b9\u6cd5\u505c\u6b62\u89c2\u5bdf\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:"showLineNumbers",children:"observe.disconnect();\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6e05\u9664\u8bb0\u5f55",children:"\u6e05\u9664\u8bb0\u5f55"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 takeRecord() \u65b9\u6cd5\u6e05\u9664\u53d8\u52a8\u8bb0\u5f55\uff0c\u5373\u4e0d\u518d\u5904\u7406\u672a\u53d8\u52a8\u7684\u53d8\u52a8\u3002"}),"\n",(0,r.jsx)(n.p,{children:"DOM \u6bcf\u4e00\u6b21\u53d8\u52a8\uff0c\u5c31\u4f1a\u4ea7\u751f\u4e00\u4e2a\u53d8\u52a8\u8bb0\u5f55\u3002\u8be5\u8bb0\u5f55\u5bf9\u5e94\u4e00\u4e2a MutationRecord \u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u5305\u542b\u4e86\u4e0e\u53d8\u52a8\u76f8\u5173\u7684\u6240\u6709\u4fe1\u606f\u3002 Mutation Observer \u8fdb\u884c\u5904\u7406\u7684\u4e00\u4e2a\u4e2a\u53d8\u52a8\u5bf9\u8c61\u6240\u7ec4\u6210\u7684\u6570\u7ec4\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"type \uff1a \u89c2\u5bdf\u53d8\u52a8\u7684\u7c7b\u578b\uff0c\u5982 \uff1a attribute \u3001 characterData \u3001 childList"}),"\n",(0,r.jsx)(n.li,{children:"target \uff1a \u53d1\u751f\u53d8\u52a8\u7684 DOM \u5bf9\u8c61"}),"\n",(0,r.jsx)(n.li,{children:"addedNodes \uff1a \u65b0\u589e\u7684 DOM \u8282\u70b9"}),"\n",(0,r.jsx)(n.li,{children:"removeNodes \uff1a \u5220\u9664\u7684 DOM \u8282\u70b9"}),"\n",(0,r.jsx)(n.li,{children:"previousSibling \uff1a \u524d\u4e00\u4e2a\u540c\u7ea7 DOM \u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\u5219\u8fd4\u56de null"}),"\n",(0,r.jsx)(n.li,{children:"nextSibling \uff1a\u4e0b\u4e00\u4e2a\u540c\u7ea7\u7684 DOM \u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\u5219\u8fd4\u56de null"}),"\n",(0,r.jsx)(n.li,{children:"attributeName \uff1a \u53d1\u751f\u53d8\u52a8\u7684\u5c5e\u6027\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 attributeFilter \uff0c\u5219\u53ea\u8fd4\u56de\u6307\u5b9a\u7684\u5c5e\u6027"}),"\n",(0,r.jsx)(n.li,{children:"oldValue \uff1a \u53d8\u52a8\u524d\u7684\u503c\u3002\u8fd9\u4e2a\u5c5e\u6027\u53ea\u5bf9 attribute \u548c characterData \u53d8\u52a8\u6709\u6548\uff1b\u5982\u679c\u53d1\u751f childList \u53d8\u52a8\uff0c\u5219\u8fd4\u56de null \u3002"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u89e6\u53d1\u4e8b\u4ef6",children:"\u89e6\u53d1\u4e8b\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 MutationObserver \u5bf9\u8c61\u65f6\u53ef\u80fd\u89e6\u53d1\u7684\u5404\u79cd\u4e8b\u4ef6\u5fc5\u987b\u8bbe\u5b9a MutationObserver \u9009\u9879\u503c\u8bf4\u660e\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'DOMAttrModified : attributes : true ( , attributeOldValue : true )(, attributeFilter:["attributeName"])'}),"\n",(0,r.jsx)(n.li,{children:'DOMAttributeNameChanged : attributes : true (, attributeOldValue : true)(, attributeFilter :\n["attributeName"])'}),"\n",(0,r.jsx)(n.li,{children:"DOMCharacterDataModified : characterData : true (,characterDataOldValue : rue)"}),"\n",(0,r.jsx)(n.li,{children:"DOMNodeInserted : childList : true( , subtree : true)"}),"\n",(0,r.jsx)(n.li,{children:"DOMNodeInsertedInfoDocument : childList : true( , subtree : true)"}),"\n",(0,r.jsxs)(n.li,{children:["DOMNodeRemoved : childList ",":true"," (,subtree : true)"]}),"\n",(0,r.jsx)(n.li,{children:"DOMNodeRemovedFormDocument : childList : true( , subtree : true)"}),"\n",(0,r.jsx)(n.li,{children:"DOMSubtreeModified : childList : true, subtree : true"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6848\u4f8b-1",children:"\u6848\u4f8b 1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",metastring:"showLineNumbers",children:'<div\n  id="div"\n  style="height:\n    100px;width:100%;background-color:pink;"\n></div>\n<input type="button" value="\u63d2\u5165 span \u5143\u7d20" onclick="changeDiv();" />\n<script type="text/javascript">\n  function onchange(mutationRecords, mutationObserver) {\n    alert(\'\u68c0\u6d4b\u5230 DOM \u53d8\u5316\');\n    console.log(mutationRecords);\n    console.log(mutationObserver);\n  }\n  var div = document.getElementById(\'div\');\n  var mo = new window.MutationObserver(onchange),\n    options = { childList: true };\n  mo.observe(div, options);\n  function changeDiv() {\n    var span = document.createElement(\'span\');\n    span.innerHTML = \'\u6211\u662f\u4e00\u4e2a span \u5143\u7d20\';\n    div.appendChild(span);\n  }\n<\/script>\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6848\u4f8b-2",children:"\u6848\u4f8b 2"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",metastring:"showLineNumbers",children:'<a id="a1" href="#a">\u94fe\u63a51</a> <a id="a2" href="#b">\u94fe\u63a52</a>\n<input type="button" value="\u4fee\u6539 a \u5143\u7d20" onclick="changeA();" />\n<script type="text/javascript">\n  function onchange(mutationRecords, mutationObserver) {\n  for (var i = 0; i <script mutationRecords.length; i++) console.log("\u4fee\u6539\u524d\u7684"\n    + mutationRecords[i].attributeName + "\u5c5e\u6027\u4e3a\uff1a" + mutationRecords[i].oldValue); }\n  var a1El = document.getElementById(\'a1\');\n  var a2El = document.getElementById(\'a2\'); var attr = ["href"];\n  var mo = new window.MutationObserver(onchange), options = {\n  attributes: true,\n  attributeFilter: attr, attributeOldValue: true };\n  mo.observe(a1El, options); mo.observe(a2El,\n    options); function changeA() {\n  a1El.setAttribute("href", "http://www.baidu.com");\n   a2El.setAttribute("href", "http://www.weibo.com"); }\n<\/script>\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},25502(e,n,t){t.d(n,{R:()=>l,x:()=>a});var i=t(10162);const r={},s=i.createContext(r);function l(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);